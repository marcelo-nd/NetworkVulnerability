# coding=utf-8
"""
Network Vulnerability
"""
import networkx as nx

myNetwork = open("2_HidroFamNet.txt")

G = nx.read_edgelist(myNetwork, delimiter="\t", nodetype=str) # If necessary, change the delimiter

myNetwork.close()

#G = nx.complete_graph(11)

def calculateEfficiency(G):
    '''
    Evaluates the efficiency of the graph G.
    '''

    N = len(nx.nodes(G))
    E1 = 1.0/(N*(N-1.0))
    pathsDict = nx.all_pairs_shortest_path_length(G)
    distances = []
    for i in pathsDict:
        for r in pathsDict[i]:
            if pathsDict[i][r] !=0:
                distances.append(1/pathsDict[i][r])
    E2 = sum(distances)
    efficiency = E1 * E2
    return efficiency


initialEfficiency = calculateEfficiency(G)
vulnerability_values=[]

# Iterates over the graph G and gets the efficiency of all the possible sub-graphs of G after removing
# each of its nodes. Then calculates the Vulnerability of each sub-graph and appends it to a list.
for n in nx.nodes(G):
    G2= G.copy()
    G2.remove_node(n)
    currentVulnerability = (initialEfficiency - calculateEfficiency(G2))/initialEfficiency
    vulnerability_values.append(currentVulnerability)

# Prints the average vulnerabilities for all sub-graphs of G.
print sum(vulnerability_values)/len(vulnerability_values)